---
import { GraphQLClient } from 'graphql-request';

// Setup GraphQL client untuk connect dengan WordPress
// Use environment variable `GRAPHQL_URL` if set (configure in Vercel Project settings)
const GRAPHQL_URL = process.env.GRAPHQL_URL || 'https://kerjasingapore.com/graphql';
const graphQLClient = new GraphQLClient(GRAPHQL_URL);

const query = `
  query {
    posts {
      nodes {
        title
        slug
        content
      }
    }
  }
`;
let data;
try {
  data = await graphQLClient.request(query);
} catch (err) {
  console.error('GraphQL fetch failed during build:', err?.message ?? err);
  data = { posts: { nodes: [] } };
}
const posts = data?.posts?.nodes ?? [];
---

<html>
  <body>
    <h1>Posts List</h1>
    <ul>
      {posts.map((post) => (
        <li>
          <h2>{post.title}</h2>
          <div set:html={post.content}></div>
        </li>
      ))}
    </ul>
  </body>
</html>
